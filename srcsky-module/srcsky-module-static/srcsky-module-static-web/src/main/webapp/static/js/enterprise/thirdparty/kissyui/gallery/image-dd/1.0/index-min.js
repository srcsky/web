KISSY.add("gallery/image-dd/1.0/asdbase",function(){function c(){}c.prototype={ATTR:function(c,e){if(!(void 0===c||null===c)){var h=this.ATTRS||{};return void 0===h[c]?void 0===e?void 0:h[c]=e:void 0===e?h[c]:h[c]=e}},DATA:function(c,e){if(!(void 0===c||null===c)){var h=this.DATAS||{};return void 0===h[c]?void 0===e?void 0:h[c]=e:void 0===e?h[c]:h[c]=e}},STATU:function(c,e){if(!(void 0===c||null===c)){var h=this.STATUS||{};return void 0===h[c]?void 0===e?void 0:h[c]=e:void 0===e?h[c]:h[c]=e}}};return c});
KISSY.add("gallery/image-dd/1.0/index",function(c,w,e,h){function s(a){this.config=c.clone(x);this.ATTRS=c.clone(o);this.STATUS=c.clone(y);this.DATAS=c.clone(z);c.mix(this.config,{ele:a?c.isArray(a)?a:[a]:[]});this._init()}function t(a){a.halt();if(m<o.DEGRADATION)return++m,!1;m=0;var b=p(a),a=b.x-this.ATTR("mousedownCoo").x,b=b.y-this.ATTR("mousedownCoo").y,b=parseInt(this.ATTR("activeImgPos").top,10)+b,a=parseInt(this.ATTR("activeImgPos").left,10)+a;this.ATTR("dragInfoX").push(a);this.ATTR("dragInfoY").push(b);
this.ATTR("dragInfoTime").push((new Date).getTime());g.css(this.ATTR("activeImg"),"top",b+"px");g.css(this.ATTR("activeImg"),"left",a+"px")}function i(a){a.halt();if(q<o.WHEEL_STEP)return++q,!1;q=0;this.cleanRecords();var b="";a.deltaY&&(b=0<a.deltaY?"zoom":"shrunk");if(""==b)return!1;if(b!=u)return u=b,!1;var d=l(this.ATTR("activeImg"),"width"),c=l(this.ATTR("activeImg"),"height");if("shrunk"==b&&d<this.ATTR("defaultMinWidth")||"zoom"==b&&d>this.ATTR("defaultMaxWidth"))return!1;var a=p(a),r=parseInt(this.ATTR("activeImg").style.left,
10),g=parseInt(this.ATTR("activeImg").style.top,10),j=l(this.ATTR("activeImg"),"left"),e=l(this.ATTR("activeImg"),"top"),f=d,n=3*o.WHEEL_PIX*(d/this.ATTR("initWidth")),i=n*(c/d);if(a.x>=r&&a.x<=r+d&&a.y>=g&&a.y<=g+c){var k=1,m=k=1,k=(a.x-r)/d,m=(a.y-g)/c;"shrunk"==b?(j+=n*k,e+=i*m):(j-=n*k,e-=i*m)}else k=0.5,"shrunk"==b?(j+=n*k,e+=i*k):(j-=n*k,e-=i*k);f="shrunk"==b?f-n:f+n;this.ATTR("anim")&&this.ATTR("anim").isRunning&&this.ATTR("anim").stop(!1);this.ATTR("anim",(new h(this.ATTR("activeImg"),{left:parseInt(1E3*
j,10)/1E3+"px",top:parseInt(1E3*e,10)/1E3+"px",width:parseInt(f,10)+"px"},0.1)).run())}function v(a){var b=p(a),a=b.x-this.ATTR("mousedownCoo").x,b=b.y-this.ATTR("mousedownCoo").y,b=parseInt(this.ATTR("activeImgPos").top,10)+b,a=parseInt(this.ATTR("activeImgPos").left,10)+a;this.ATTR("dragInfoX").push(a);this.ATTR("dragInfoY").push(b);this.ATTR("dragInfoTime").push((new Date).getTime());this.cancelEvent();this.afterUserDrag_MyShowTime()}function p(a){return{x:a.pageX||a.clientX+(document.documentElement.scrollLeft||
document.body.scrollLeft),y:a.pageY||a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)}}function l(a,b){var d="";if(c.UA&&c.UA.ie&&"IMG"==a.tagName&&"height"==b)return a.offsetHeight;window.getComputedStyle?d=window.getComputedStyle(a,null)[b]:(b=A(b),d=a.currentStyle[b]);d=d.replace(/[^0-9+-\.]/g,"");return parseInt(d,10)?0-(0-d):0}function A(a){return a.replace(/-([a-z])/gi,function(a,d){return d.toUpperCase()})}var g=c.DOM,f=c.Event,o={WHEEL_STEP:1,WHEEL_PIX:50,SHOW_DOWN:0,
MOUSE_MOVE_AUTO_CLOSE_TIMER:5E3,DEGRADATION:2,activeImg:null,activeImgPos:{left:0,top:0},mousedownCoo:{},anim:null,initAnim:null,bigImgObj:new Image,initWidth:0,defaultMaxWidth:1E4,defaultMinWidth:50,ieIframeMask:null,dragInfoX:[],dragInfoY:[],dragInfoTime:[],autoSlideAnim:null,popupMask:null,popupBd:null,popupOpacityBg:null,popupBox:null,popupHd:null},y={inited:!1},z={POPUP_HD_TPL:'<div class="box-hd close-rt-wrap" ><a href="#" title="\u6309\u9000\u51fa\u952e\uff0c\u4e5f\u53ef\u4ee5\u5173\u95ed\u54e6" class="close-rt J_Close" id="J_CloseImageDD"></a></div>',
POPUP_IMG:'<img title="\u9f20\u6807\u6eda\u8f6e\u53ef\u4ee5\u653e\u5927\u56fe\u7247" class="G_K" style="width:{{showWidth}}px;left:{{left}}px;top:{{top}}px;" src="{{imgSrc}}"  />',POPUP_TPL:'<div class="img-dd-mask">                    <div class="img-dd-opacity-bg"></div>                 </div>',POPUP_BOX_TPL:'<div class="img-dd-box"></div>',POPUP_IFRAME_TPL:'<iframe class="ie-popup-mask hidden"></iframe>'},x={ele:[]},m=o.DEGRADATION,q=o.WHEEL_STEP,u="";c.augment(s,w,c.EventTarget,{_init:function(){var a=
this;c.each(a.config.ele,function(b){a._bindEvent(b)})},add:function(a,b){var d=this,e=d.config;c.isArray(a)?(e.ele=e.ele.concate(a),c.each(a,function(a){d._bindEvent(a,b)})):(e.ele.push(a),d._bindEvent(a,b))},_bindEvent:function(a,b){var d=this;if(null==a)return!1;f.on(a,"click",function(a){var c=a.target;if("IMG"==c.tagName.toUpperCase()&&(!b||g.hasClass(c,b))&&"G_K"!=c.className)a.halt(),!0!=d.STATU("inited")&&(d._createPopup(),d._initHTMLElement(),d._bindPopupMousedown(),d.STATU("inited",!0)),
d._showPopupImg(c.getAttribute("data-original-url")?c.getAttribute("data-original-url"):c.getAttribute("_src_"),c.getAttribute("src")),g.show(d.ATTR("popupMask")),g.show(d.ATTR("popupBd")),g.show(d.ATTR("ieIframeMask")),g.show(d.ATTR("closeBtn"))})},_showPopupImg:function(a,b){var d=this,f=document.body.clientWidth||doucment.doucmentElement.clientWidth;d.ATTR("popupBd").innerHTML=e(d.DATA("POPUP_IMG")).render({imgSrc:b,imgAlt:"\u56fe\u7247\u5927\u56fe",showWidth:parseInt(f/2,10),left:parseInt(f/4,
10),top:0});c.UA.ie&&6==c.UA.ie&&(d.ATTR("popupMask").style.height=(document.body.scrollHeight||document.documentElement.scrollHeight)+"px",d.ATTR("popupMask").style.width=(document.body.scrollWidth||document.documentElement.scrollWidth)+"px");d.ATTR("initWidth",parseInt(f/2,10));d.cleanRecords(!0);d.ATTR("activeImg",g.get("IMG",d.ATTR("popupBd")));d.ATTR("initAnim")&&d.ATTR("initAnim").stop(!1);d.ATTR("initAnim",(new h(d.ATTR("activeImg"),{top:(document.body.scrollTop||document.documentElement.scrollTop)+
30+"px"},1,"easeOutStrong")).run());d.ATTR("bigImgObj").onload=null;if(a||""!=a)d.ATTR("bigImgObj",null),d.ATTR("bigImgObj",new Image),d.ATTR("bigImgObj").onload=function(){d.ATTR("activeImg").src=a};d.ATTR("bigImgObj").src=a;d.registerWheelEvent()},registerWheelEvent:function(){f.on(document,"DOMMouseScroll",i,this);f.on(document,"mousewheel",i,this);f.on(document,"keyup",this.closePopup,this)},cancelWheelEvent:function(){f.remove(document,"DOMMouseScroll",i,this);f.remove(document,"mousewheel",
i,this);f.remove(document,"keyup",this.closePopup,this)},registerEvent:function(){f.on(document,"mouseup",v,this);f.on(document,"mousemove",t,this)},cancelEvent:function(){f.remove(document,"mouseup",v,this);f.remove(document,"mousemove",t,this)},_createPopup:function(){this.ATTR("popupMask",g.create(this.DATA("POPUP_TPL")));this.ATTR("popupBd",g.create(this.DATA("POPUP_BOX_TPL")));this.ATTR("closeBtn",g.create(this.DATA("POPUP_HD_TPL")));c.UA.ie&&6==c.UA.ie&&(this.ATTR("ieIframeMask",g.create(this.DATA("POPUP_IFRAME_TPL"))),
this.ATTR("ieIframeMask").style.width=document.documentElement.scrollWidth+"px",this.ATTR("ieIframeMask").style.height=document.documentElement.scrollHeight+"px",document.body.appendChild(this.ATTR("ieIframeMask")));document.body.appendChild(this.ATTR("popupMask"));document.body.appendChild(this.ATTR("popupBd"));this.ATTR("popupMask").appendChild(this.ATTR("closeBtn"))},_bindPopupMousedown:function(){var a=this;f.on(a.ATTR("popupBd"),"mousedown",function(b){var d=b.target;"IMG"==d.tagName.toUpperCase()&&
(b.halt(),a.ATTR("initAnim")&&a.ATTR("initAnim").stop(!1),a.ATTR("initAnim",null),a.cleanRecords(!0),a.ATTR("dragInfoX").push(l(d,"left")),a.ATTR("dragInfoY").push(l(d,"top")),a.ATTR("dragInfoTime").push((new Date).getTime()),a.ATTR("activeImg",d),a.ATTR("mousedownCoo",p(b)),a.ATTR("activeImgPos",{left:l(d,"left"),top:l(d,"top")}),a.registerEvent())});f.on(a.ATTR("closeBtn"),"click",function(b){b.halt();a.closePopup()});f.on(a.ATTR("popupMask"),"click",function(b){c.UA.ie&&6==c.UA.ie&&g.hasClass(b.target,
"img-dd-opacity-bg")&&(b.halt(),a.closePopup())});return!0},_initHTMLElement:function(){this.ATTR("popupOpacityBg",g.get(".img-dd-opacity-bg",this.ATTR("popupMask")));this.ATTR("popupBox",g.get(".img-dd-box",this.ATTR("popupMask")));this.ATTR("popupHd",g.get(".box-hd",this.ATTR("popupMask")))},afterUserDrag_MyShowTime:function(){this.ATTR("dragInfoX");this.slide_straightLine();return!1},slide_straightLine:function(){var a=0,b=0,d,c,e,g=this.ATTR("dragInfoX");e=this.ATTR("dragInfoY");var f=g.length,
a=this.ATTR("dragInfoTime"),b=1;for(t0=a[f-1];b<f&&50>t0-a[f-++b];);2==b&&500<t0-a[f-b]||(b<=f?(t1=a[f-b+1],g=g[f-1]-g[f-b],e=e[f-1]-e[f-b],a=1E3*(g/(t0-t1)),b=1E3*(e/(t0-t1)),0<g?d=!0:d=!1,0<e?c=!0:c=!1):(b=a=100,g[f-1]>g[0]?d=!0:d=!1,e[f-1]>e[0]?c=!0:c=!1),e=parseInt(Math.abs(NaN),10),d=(d?"+=":"-=")+a*a/2/1E5,c=(c?"+=":"-=")+b*b/2/1E5,this.ATTR("autoSlideAnim",(new h(this.ATTR("activeImg"),{left:d,top:c},e,"easeOutStrong")).run()))},cleanRecords:function(){this.ATTR("dragInfoX",[]);this.ATTR("dragInfoY",
[]);this.ATTR("dragInfoTime",[]);this.ATTR("autoSlideAnim")&&this.ATTR("autoSlideAnim").isRunning&&this.ATTR("autoSlideAnim").stop(!1)},closePopup:function(a){if(void 0!=a&&a instanceof KISSY.EventObject){var b=a.keyCode||a.charCode;if(a.altKey||27!=b)return!1}this.ATTR("activeImg",null);this.cancelWheelEvent();this.cancelEvent();g.hide(this.ATTR("popupMask"));g.hide(this.ATTR("popupBd"));g.hide(this.ATTR("closeBtn"));g.hide(this.ATTR("ieIframeMask"))},destory:function(){}});var B=new s;return c.DDObj=
{add:function(a,b){B.add(a,b)}}},{requires:["./asdbase","gallery/template/1.0/index","anim","./assets/image-dd.css"]});
