/*
Copyright 2013, KISSY UI Library v1.30
MIT Licensed
build time: Jan 28 14:33
*/
KISSY.add("event/dom/touch/double-tap",function(f,c,d,a){function b(){}f.extend(b,a,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,e=a.timeStamp,c=a.target,j=a.changedTouches[0],h=e-this.startTime;this.lastEndTime=e;if(b&&(h=e-b,300>h)){this.lastEndTime=0;d.fire(c,"doubleTap",
{touch:j,duration:h/1E3});return}h=e-this.startTime;300<h?d.fire(c,"singleTap",{touch:j,duration:h/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(c,"singleTap",{touch:j,duration:h/1E3})},300)}});c.singleTap=c.doubleTap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(f,c){var d=c.Gesture,a,b,g;f.Features.isTouchSupported()&&(a="touchstart",b="touchmove",g="touchend");a&&(d.start=a,d.move=b,d.end=g,d.tap="tap",d.doubleTap="doubleTap");return d},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(f,c,d,a,b){function g(h){this.doc=h;this.eventHandle={};this.init()}var i=f.guid("touch-handle"),e=f.Features,k={};k[b.start]="onTouchStart";k[b.move]="onTouchMove";k[b.end]="onTouchEnd";"mousedown"!==b.start&&(k.touchcancel="onTouchEnd");var j=f.throttle(function(h){this.callEventHandle("onTouchMove",h)},30);g.prototype={init:function(){var h=this.doc,l,b;for(l in k){b=k[l];a.on(h,l,this[b],this)}},normalize:function(h){var l=h.type,a;if(!e.isTouchSupported()){if(l.indexOf("mouse")!=
-1&&h.which!=1)return;a=[h];l=!l.match(/up$/i);h.touches=l?a:[];h.targetTouches=l?a:[];h.changedTouches=a}return h},onTouchMove:function(h){j.call(this,h)},onTouchStart:function(h){var a,b,e=this.eventHandle;for(a in e){b=e[a];b.isActive=1}this.callEventHandle("onTouchStart",h)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a)},callEventHandle:function(a,b){var e=this.eventHandle,d,c;if(b=this.normalize(b)){for(d in e){c=e[d];if(!c.processed){c.processed=1;if(c.isActive&&c[a](b)===false)c.isActive=
0}}for(d in e){c=e[d];c.processed=0}}},addEventHandle:function(a){var b=d[a].handle;this.eventHandle[a]||(this.eventHandle[a]=b)},removeEventHandle:function(a){delete this.eventHandle[a]},destroy:function(){var b=this.doc,e,c;for(e in k){c=k[e];a.detach(b,e,this[c],this)}}};return{addDocumentHandle:function(a,b){var e=c.getWindow(a.ownerDocument||a).document,j=d[b].setup,f=c.data(e,i);f||c.data(e,i,f=new g(e));j&&j.call(a,b);f.addEventHandle(b)},removeDocumentHandle:function(a,b){var e=c.getWindow(a.ownerDocument||
a).document,j=d[b].tearDown,g=c.data(e,i);j&&j.call(a,b);if(g){g.removeEventHandle(b);if(f.isEmptyObject(g.eventHandle)){g.destroy();c.removeData(e,i)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(f,c){function d(){}d.prototype={requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,c=a.touches.length;c===b?this.start():c>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}},end:function(a){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,c,d,a,b){function g(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}f.extend(g,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,c,h=b[0],g=b[1];c=h.pageX-g.pageX;h=h.pageY-g.pageY;c=Math.sqrt(c*c+h*h);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",f.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",f.mix(a,
{distance:c,scale:1})))}},fireEnd:function(a){d.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});a=new g;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,setup:function(){d.on(this,b.move,i)},tearDown:function(){d.detach(this,b.move,i)}};return g},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,c,d,a,b,g){function i(){}function e(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var k=180/Math.PI;f.extend(i,d,{onTouchMove:function(b){if(this.isTracking){var c=b.touches,e=c[0],d=c[1],i=this.lastAngle,e=Math.atan2(d.pageY-e.pageY,d.pageX-e.pageX)*k;if(i!==g){var d=Math.abs(e-i),m=(e+360)%360,n=(e-360)%360;Math.abs(m-i)<d?e=m:Math.abs(n-i)<d&&(e=n)}this.lastTouches=c;this.lastAngle=e;this.isStarted?a.fire(this.target,"rotate",f.mix(b,{angle:e,
rotation:e-this.startAngle})):(this.isStarted=!0,this.startAngle=e,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",f.mix(b,{angle:e,rotation:0})))}},end:function(){this.lastAngle=g;i.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",f.mix(b,{touches:this.lastTouches}))}});d=new i;c.rotateEnd=c.rotateStart={handle:d};c.rotate={handle:d,setup:function(){a.on(this,b.move,e)},tearDown:function(){a.detach(this,b.move,e)}};return i},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch",function(f){function c(){}c.prototype={requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return c});
KISSY.add("event/dom/touch/swipe",function(f,c,d,a,b){function g(){}function i(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(g,a,{onTouchStart:function(a){if(!1===g.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),
c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,f=b.pageY-this.startY,g=Math.abs(c),i=Math.abs(f);this.isVertical&&50>i&&(this.isVertical=0);this.isHorizontal&&50>g&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=
0>f?"up":"down",g=i;else return!1;d.fire(a.target,"swipe",{touch:b,direction:c,distance:g,duration:(a.timeStamp-this.startTime)/1E3})}});c.swipe={setup:function(){d.on(this,b.move,i)},tearDown:function(){d.detach(this,b.move,i)},handle:new g};return g},{requires:["./handle-map","event/dom/base","./single-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,c,d,a,b){function g(){}function i(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(g,d,{onTouchStart:function(b){if(!1===g.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){a.fire(b.target,"tapHold",{touch:b.touches[0],duration:(f.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={setup:function(){a.on(this,
b.start,i)},tearDown:function(){a.detach(this,b.start,i)},handle:new g};return g},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(f,c,d,a){function b(){}f.extend(b,a,{onTouchMove:function(){return!1},onTouchEnd:function(a){d.fire(a.target,"tap",{touch:a.changedTouches[0]})}});c.tap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(f,c,d,a){var f=c._Special,c={setup:function(b){a.addDocumentHandle(this,b)},tearDown:function(b){a.removeDocumentHandle(this,b)}},b;for(b in d)f[b]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
